.PAGE 'MAIN'

PASS1	LDX #STKVAL
	TXS
	JSR LD0E9
	JMP PASS1

LD0E9	LDA #0
	STA L1F
	STA IFLAGS+1
	STA ICSB
	STA ICSE
	STA IERR
	STA ICSL
	STA IEXP
	STA IEXP+1
	STA JLABL
	STA JORG
	STA JBYWOR
	STA ICOLP
	TAY
LD104	JSR INALL
	JSR OUTDP1
	CMP #$0A
	BEQ LD104
	CMP #$7F
	BEQ LD104
	CMP #$0D
	BEQ LD128
	CMP #$00
	BNE LD11D
	JMP H10

LD11D	CPY #$3C
	BCS LD124
	STA ICRD,Y
LD124	INY
	JMP LD104

LD128	STY IMAXCL
	JSR LDCA9
	JSR RCHEK


;
;  MAIN LINE BLOCK
;

H87	JSR NFNDNB      ;BLANK CARD?
	BCC LD16F
	CMP #';'        ;IF TERMINATOR CARD
	BEQ LD16F
	JSR NFNDEN      ;FIND STRING END
	BCC LD176
	LDX ICSB
	LDA ICRD,X
	CMP #'.'
	BNE H8841       ;NOT ASSEM DIRECT
	JMP H5          ;AN ASSEM DIRECT

H8841	CMP #'*'
	BNE H8832       ;NOT AN ORG
	JMP H102        ;REDEFINE ORG

H8832	LDY ICSL
	CPY #7          ;6 CHARACTERS LONG
	LDA #9
	BCS LD187
	STY KLEN        ;LENGTH OF SYMBOL
	JSR CONSYM      ;CONSTRUCT THE SYMBOL
	LDA #$10
	BCC LD187
H3	LDA ICSL        ;LENGTH OF STRING
	CMP #3          ;RIGHT LENGTH FOR LABEL
	BNE H92         ;LABEL PROCESS-OVER 3
	JSR NOPFND      ;FIND A MNEMONIC
	BCC H92         ;FAILED-MUST BE A LABEL
	JMP H201        ;AN OP CODE

LD16F	JMP LD68A

; ************************
; *   LABEL PROCESSING
; ************************

H92	LDA JLABL
	BEQ H94
LD176	LDA #$03
	BNE LD187

H94	LDA #1
	STA JLABL
	LDX ICOLP
	JSR NALPH
	BCS H91         ;NO
	LDA #$08
LD187	JMP LD67A

LD18A	LDA #$20
	BNE LD187

H91	LDA ISYM+1
	CMP #' '
	BNE LD1A0
	LDA ISYM

	LDX #$04
LD198	CMP LDFA3,X
	BEQ LD18A
	DEX
	BPL LD198

LD1A0	LDX #0          ;SAVE THE SYMBOL
H8845	LDA ISYM,X
	PHA
	INX
	CPX #6
	BNE H8845

	LDA ICSL        ;SAVE ICSL
	PHA
	JSR LD6CA       ;CHECK FOR EQUATE
	BCC H120        ;ONLY BLANKS FOUND
	CMP #'='
	BEQ H121

H120	JSR NFIND       ;SEE IF GOOD LABEL
	BCC H95B        ;NOT PRESENT
	LDA KNVAL       ;IS THE NEW VALUE THE SAME AS THE OLD VALUE ?
	CMP IPC+1
	BNE MR04        ;NO
	LDA KNVAL+1
	CMP IPC
	BEQ H95A        ;OK

MR04	LDA #2          ;PREVIOUSLY DEFINED
	BNE LD208

H95B	LDA IPC+1       ;PUT IN SYM TAB
	LDY IPC
	JSR NSERT
H95A	LDA ICOLP       ;TRY FOR OPCODE
	CMP IMAXCL       ;OFF CARD CHECK
	BCS LD16F
	JMP H87         ;BACK TO MAIN SECT

.END
